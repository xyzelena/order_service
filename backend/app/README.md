# Order Service - Go Application

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PostgreSQL, Kafka –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏.

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

1. **HTTP API** - RESTful API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ ID
2. **Kafka Consumer** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
3. **PostgreSQL** - –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î
4. **In-Memory Cache** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–º –∑–∞–∫–∞–∑–∞–º
5. **Cache Recovery** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞ –∏–∑ –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
6. **Web Interface** - –ø—Ä–æ—Å—Ç–æ–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
7. **Error Handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
8. **Graceful Shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ cmd/server/              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ main.go             # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ internal/               # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–∫–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ models/             # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ database/           # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ cache/              # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ kafka/              # Kafka consumer
‚îÇ   ‚îî‚îÄ‚îÄ handlers/           # HTTP handlers –∏ API
‚îú‚îÄ‚îÄ pkg/config/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ static/                 # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ Makefile               # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ go.mod                 # Go –º–æ–¥—É–ª—å –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ env.example            # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–Ø–∑—ã–∫**: Go 1.21+
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 15
- **–û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π**: Apache Kafka
- **HTTP Router**: Gorilla Mux
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: Logrus
- **Containerization**: Docker

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. Go 1.21+
2. PostgreSQL (—á–µ—Ä–µ–∑ Docker –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)
3. Apache Kafka (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
   ```bash
   cp env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –ø–æ–¥ –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
   ```bash
   make deps
   ```

3. **–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫**:
   ```bash
   make build
   make run
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**:
   - –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8080/api/v1/

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

```bash
make docker-build
make docker-run
```

## üì° API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `GET` | `/api/v1/orders/{order_uid}` | –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ UID |
| `GET` | `/api/v1/orders?limit=10` | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ |
| `GET` | `/api/v1/cache/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ |
| `GET` | `/api/v1/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞ |

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

| –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `/` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ñ–æ—Ä–º–æ–π –ø–æ–∏—Å–∫–∞ |
| `/order/{order_uid}` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ |

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞**:
```bash
curl http://localhost:8080/api/v1/orders/b563feb7b2b84b6test
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞**:
```bash
curl http://localhost:8080/api/v1/cache/stats
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è**:
```bash
curl http://localhost:8080/api/v1/health
```

## üóÑÔ∏è –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 4 –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:

- **orders** - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö
- **deliveries** - –¥–∞–Ω–Ω—ã–µ –æ –¥–æ—Å—Ç–∞–≤–∫–µ
- **payments** - –ø–ª–∞—Ç–µ–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **order_items** - —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ

–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î –æ–ø–∏—Å–∞–Ω–∞ –≤ [../database/DATABASE_SCHEMA.md](../database/DATABASE_SCHEMA.md)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `SERVER_HOST` | –•–æ—Å—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `0.0.0.0` |
| `SERVER_PORT` | –ü–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |
| `DB_HOST` | –•–æ—Å—Ç PostgreSQL | `localhost` |
| `DB_PORT` | –ü–æ—Ä—Ç PostgreSQL | `5432` |
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î | `user` |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î | `0000` |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `order_service_db` |
| `KAFKA_BROKERS` | –ê–¥—Ä–µ—Å–∞ Kafka –±—Ä–æ–∫–µ—Ä–æ–≤ | `localhost:9092` |
| `KAFKA_TOPIC` | –¢–æ–ø–∏–∫ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ | `orders` |
| `KAFKA_GROUP_ID` | ID –≥—Ä—É–ø–ø—ã consumer'–∞ | `order-service-group` |
| `CACHE_MAX_SIZE` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞ | `1000` |
| `DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | `false` |

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **LRU –∞–ª–≥–æ—Ä–∏—Ç–º** - –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
- **Thread-safe** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
- **Recovery** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∏–∑ –ë–î

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- **Graceful degradation** - –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. Kafka Integration
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–∞
- **Error handling** - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- **Graceful shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ consumer'–∞

### 4. Database
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∞—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Connection pooling** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Normalized schema** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º
make lint

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make fmt
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

- **Health check** - `/api/v1/health`
- **Cache statistics** - —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞, hit/miss ratio
- **HTTP request logs** - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã
- **Database connection status**

## üöÄ Production Ready Features

1. **Graceful Shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. **Configuration via Environment** - 12-factor app –ø—Ä–∏–Ω—Ü–∏–ø—ã
3. **Structured Logging** - JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
4. **Health Checks** - —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
5. **Docker Support** - –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ –¥–ª—è –¥–µ–ø–ª–æ—è
6. **Error Recovery** - —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º

## üîç –û—Ç–ª–∞–¥–∫–∞

1. **–í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏**:
   ```bash
   export DEBUG=true
   ./server
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**:
   ```bash
   curl http://localhost:8080/api/v1/health
   ```

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞**:
   ```bash
   curl http://localhost:8080/api/v1/cache/stats
   ```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ Kafka, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å HTTP API
- –ö–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –í—Å–µ API –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç JSON —Å –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –æ—Ç–≤–µ—Ç–æ–≤
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
